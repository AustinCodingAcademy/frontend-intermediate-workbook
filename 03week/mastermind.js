My code is on the private gist.